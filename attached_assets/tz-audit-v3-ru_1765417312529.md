# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: AI-–°–∏—Å—Ç–µ–º–∞ –∞—É–¥–∏—Ç–∞ –§–ó-152, –§–ó-149, GDPR v3.0
## –° –æ—Ç–∫—Ä—ã—Ç—ã–º–∏ —Ä—É—Å—Å–∫–∏–º–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞–º–∏ –∏ Python-—Å–∫—Ä–µ–ø–µ—Ä–æ–º

**–î–∞—Ç–∞:** 11 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 3.0 (–§–ó-152 + –§–ó-149 –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 2025 –≥–æ–¥, –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–µ–ø–µ—Ä)  
**–°—Ç–∞—Ç—É—Å:** Production-Ready MVP

---

## üìã –û–ë–ó–û–† –°–ò–°–¢–ï–ú–´

### –ß—Ç–æ —ç—Ç–æ?
–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ–±-—Å–∞–π—Ç–æ–≤ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:
- **–§–ó-152** (–û –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) - 30 –º–∞—è 2025 (–æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ, –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
- **–§–ó-149** (–û–± –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏) - –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **GDPR** (–ï–≤—Ä–æ–ø–µ–π—Å–∫–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) - –ø—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤, —Ç—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—á–∏
- **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** - 1 —Å–µ–Ω—Ç—è–±—Ä—è 2025
- **Cookies & Tracking** - –æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ 2025

### –ò–Ω–Ω–æ–≤–∞—Ü–∏—è: 2-—É—Ä–æ–≤–Ω–µ–≤—ã–π –∞–Ω–∞–ª–∏–∑
```
–£—Ä–æ–≤–µ–Ω—å 1 (–ë–´–°–¢–†–´–ô, rule-based, Selenium + regex):
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS –∏ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
‚îú‚îÄ –ü–æ–∏—Å–∫ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ (regex –ø–æ HTML)
‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–≥–ª–∞—Å–∏—è (—á–µ–∫–±–æ–∫—Å—ã, —Ñ–æ—Ä–º)
‚îú‚îÄ IP-–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö)
‚îú‚îÄ –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–µ—Ä–æ–≤ –∏ –ø–∏–∫—Å–µ–ª–µ–π
‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ –∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ ‚Üí –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$0.01/–∞—É–¥–∏—Ç

–£—Ä–æ–≤–µ–Ω—å 2 (–ì–õ–£–ë–û–ö–ò–ô, LLM-based, Gigachat/GPT-4):
‚îú‚îÄ –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ –æ—à–∏–±–∫–∏
‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ü–î–Ω
‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è DPA –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
‚îú‚îÄ –û—Ü–µ–Ω–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ –º–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îî‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π ‚Üí –°—Ç–æ–∏–º–æ—Å—Ç—å: $0.10-0.30 –∑–∞ –∞—É–¥–∏—Ç (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?
1. –ö–ª–∏–µ–Ω—Ç –≤–≤–æ–¥–∏—Ç URL ‚Üí —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã
2. **–£—Ä–æ–≤–µ–Ω—å 1** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π): Selenium —Å–∫—Ä–µ–ø–∏—Ç —Å–∞–π—Ç, –∏—â–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏–∏ (‚âà5-15 –º–∏–Ω)
3. –ï—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π 0-3 ‚Üí –æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π/–±–∞–∑–æ–≤—ã–π)
4. –ï—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π 4+ ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–£—Ä–æ–≤–µ–Ω—å 2** (Gigachat)
5. Gigachat –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –∑–æ–Ω—ã ‚Üí —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
6. PDF-–æ—Ç—á–µ—Ç –≥–æ—Ç–æ–≤ (–ø—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø –∑–∞ 900‚ÇΩ)

---

## üõ† –ê–†–•–ò–¢–ï–ö–¢–£–†–ê (v3.0)

### Backend Stack (Python-based)
```yaml
–°–∫—Ä–µ–ø–µ—Ä –£—Ä–æ–≤–Ω—è 1:
  - Selenium + ChromeDriver: –¥–ª—è —Å–∫—Ä–µ–ø–∏–Ω–≥–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JS
  - BeautifulSoup4: –ø–∞—Ä—Å–∏–Ω–≥ HTML
  - Requests + aiohttp: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
  - Regex + NLTK: –ø–æ–∏—Å–∫ –∫–ª—é—á–µ–≤—ã—Ö —Ñ—Ä–∞–∑
  - GeoIP2: IP –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)

–°–∫—Ä–µ–ø–µ—Ä –£—Ä–æ–≤–Ω—è 2:
  - GigaChat API (SberCloud): –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –†–§!)
  - OpenAI GPT-4 (fallback): –µ—Å–ª–∏ Gigachat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - LangChain: –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è LLM-–∑–∞–ø—Ä–æ—Å–æ–≤

–•—Ä–∞–Ω–∏–ª–∏—â–µ + –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - PostgreSQL –∏–ª–∏ SQLite (–¥–ª—è MVP): —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞—É–¥–∏—Ç–æ–≤
  - Redis: –∫–µ—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ DNS, SSL, IP
  - Sentry: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

API:
  - FastAPI (Python) + Pydantic: REST API
  - WebSocket: live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∞—É–¥–∏—Ç–∞
```

### –†—É—Å—Å–∫–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã Firecrawl:

| –°–µ—Ä–≤–∏—Å | –¢–∏–ø | –¶–µ–Ω–∞ | –ó–∞—á–µ–º –Ω–∞–º |
|--------|-----|------|----------|
| **Crawl4AI** | Open-source —Å–∫—Ä–µ–ø–µ—Ä | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–µ–ø–µ—Ä (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π) |
| **ScrapeGraphAI** | LLM-—Å–∫—Ä–µ–ø–µ—Ä | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (–ª–æ–∫.) / $20-500/–º–µ—Å | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ |
| **Selenium + requests** | –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–∫—Ä–µ–ø–µ—Ä) |
| **GigaChat API** | LLM (–°–±–µ—Ä) | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (250 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å—É—Ç–∫–∏ –¥–ª—è –ª–∏—á–Ω—ã—Ö) | –û—Å–Ω–æ–≤–Ω–æ–π LLM –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ |
| **–Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã API** | IP –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è | –ë–µ—Å–ø–ª–∞—Ç–Ω–æ (–¥–æ 25k –∑–∞–ø—Ä–æ—Å–æ–≤) | –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö |

**–ü–æ—á–µ–º—É Selenium –≤–º–µ—Å—Ç–æ Firecrawl?**
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∫—Ä–µ–ø–∏–Ω–≥–æ–º ‚úÖ
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ –≤ –†–§ ‚úÖ
- –ú–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏ Cloudflare —Å –ø–æ–º–æ—â—å—é `cloudscraper` ‚úÖ
- –ë–µ—Å–ø–ª–∞—Ç–µ–Ω –∏ open-source ‚úÖ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–∫—Ä–µ–ø–∏–Ω–≥ (–∫–ª–∏–∫–∏, —Ñ–æ—Ä–º—ã, —Å–∫—Ä–æ–ª–ª–∏–Ω–≥) ‚úÖ

---

## üìä 70+ –ö–†–ò–¢–ï–†–ò–ï–í –ü–†–û–í–ï–†–ö–ò (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞ 2025)

### –ì—Ä—É–ø–ø–∞ –§–ó-152: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (30 –º–∞—è - 1 —Å–µ–Ω—Ç—è–±—Ä—è 2025)

#### –°–æ–≥–ª–∞—Å–∏–µ –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (6 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- **–ü–î–Ω-001**: –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ ‚â•1 —É—Ä–æ–≤–Ω—è –≤—ã—à–µ –∫–æ—Ä–Ω—è ‚úì
- **–ü–î–Ω-002**: –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω - –û–¢–î–ï–õ–¨–ù–û–ï –æ—Ç –¥—Ä—É–≥–∏—Ö —Å–æ–≥–ª–∞—Å–∏–π (–Ω–æ–≤–æ–µ 30.05.2025) ‚úì
- **–ü–î–Ω-003**: –°–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–∞–Ω–∞–ª–∏—Ç–∏–∫–∞, —Ç—Ä–µ–∫–µ—Ä—ã) –æ—Ç–¥–µ–ª—å–Ω–æ–µ (–Ω–æ–≤–æ–µ 30.05.2025) ‚úì
- **–ü–î–Ω-004**: –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ª–∏—Ü–∞ / DPO —É–∫–∞–∑–∞–Ω–∞ ‚úì
- **–ü–î–Ω-005**: –°–≤–µ–¥–µ–Ω–∏—è –æ –º–µ—Å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —É–∫–∞–∑–∞–Ω—ã ‚úì
- **–ü–î–Ω-006**: –°–≤–µ–¥–µ–Ω–∏—è –æ —Ü–µ–ª—è—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–∫–∞–∑–∞–Ω—ã ‚úì

#### –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (1 —Å–µ–Ω—Ç—è–±—Ä—è 2025) (5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- **–ü–î–Ω-007**: –°–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –†–§ (–ø—Ä–æ–≤–µ—Ä–∫–∞ IP, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ WHOIS) ‚úì
- **–ü–î–Ω-008**: –ë—ç–∫–∞–ø—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –†–§ (—Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω–ø—É—Ç –∫–ª–∏–µ–Ω—Ç–∞) ‚ö†Ô∏è
- **–ü–î–Ω-009**: CDN –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ü–î–Ω (–ø—Ä–æ–≤–µ—Ä–∫–∞ Headers) ‚úì
- **–ü–î–Ω-010**: –¢—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã –∏–ª–∏ –µ—Å—Ç—å DPA –∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚ö†Ô∏è
- **–ü–î–Ω-011**: –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ - —Ç–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–∏–¥–µ–æ) ‚ö†Ô∏è

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- **–ü–î–Ω-012**: HTTPS –≤–∫–ª—é—á–µ–Ω –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å–∞–π—Ç–∞ ‚úì
- **–ü–î–Ω-013**: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤–∞–ª–∏–¥–µ–Ω –∏ –Ω–µ –∏—Å—Ç—ë–∫ ‚úì
- **–ü–î–Ω-014**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –≤–∫–ª—é—á–µ–Ω–æ (–ø—Ä–æ–≤–µ—Ä–∫–∞ headers, /robots.txt) ‚ö†Ô∏è
- **–ü–î–Ω-015**: –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Right to Erasure) –≤–æ–∑–º–æ–∂–Ω–∞ ‚ö†Ô∏è
- **–ü–î–Ω-016**: –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö (TLS 1.2+) ‚úì

### –ì—Ä—É–ø–ø–∞ –§–ó-149: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Ü–∏—Ñ—Ä–æ–≤—ã–µ –ø—Ä–∞–≤–∞ (4 –∫—Ä–∏—Ç–µ—Ä–∏—è)

- **–ò–Ω—Ñ-001**: –°–æ–±–ª—é–¥–µ–Ω–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –æ–± –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ (+18, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ) ‚úì
- **–ò–Ω—Ñ-002**: –†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –£–ù–ü/–ò–ù–ù —É–∫–∞–∑–∞–Ω—ã ‚úì
- **–ò–Ω—Ñ-003**: –°–ø–æ—Å–æ–± –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —Å–∞–π—Ç–∞ —É–∫–∞–∑–∞–Ω ‚úì
- **–ò–Ω—Ñ-004**: –£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã ‚úì

### –ì—Ä—É–ø–ø–∞ GDPR: –ï–≤—Ä–æ–ø–µ–π—Å–∫–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (16 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∞–≤–∞ (6 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)
- **GDPR-001**: –ü—Ä–∞–≤–æ –Ω–∞ –¥–æ—Å—Ç—É–ø (–ø—Ä–∞–≤–æ —Å–∫–∞—á–∞—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ) —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì
- **GDPR-002**: –ü—Ä–∞–≤–æ –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì
- **GDPR-003**: –ü—Ä–∞–≤–æ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ ("Right to Erasure") —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì
- **GDPR-004**: –ü—Ä–∞–≤–æ –Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì
- **GDPR-005**: –ü—Ä–∞–≤–æ –Ω–∞ –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì
- **GDPR-006**: –ü—Ä–∞–≤–æ –Ω–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úì

#### Transparencia –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (4 –∫—Ä–∏—Ç–µ—Ä–∏—è)
- **GDPR-007**: Privacy Policy —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ ‚úì
- **GDPR-008**: DPIA (Data Protection Impact Assessment) –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–∏—Å–∫–æ–≤ ‚ö†Ô∏è
- **GDPR-009**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Ç–µ—á–∫–µ –¥–∞–Ω–Ω—ã—Ö (Breach notification) –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è ‚ö†Ô∏è
- **GDPR-010**: DPA –∫–æ–Ω—Ç—Ä–∞–∫—Ç (Data Processing Agreement) —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º–∏ ‚ö†Ô∏è

#### –¢—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—á–∏ (3 –∫—Ä–∏—Ç–µ—Ä–∏—è) ‚Äî –Ω–æ–≤–æ–µ Schrems II
- **GDPR-011**: –¢—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –°–®–ê - –∞–Ω–∞–ª–∏–∑ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ (SCCs, Adequacy) ‚ö†Ô∏è
- **GDPR-012**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π (SCCs) ‚ö†Ô∏è
- **GDPR-013**: –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –¥–æ–ø. –º–µ—Ä—ã –ø–æ Schrems II —Å—É–¥–µ–±–Ω—ã–º —Ä–µ—à–µ–Ω–∏—è–º ‚ö†Ô∏è

#### GDPR + AI (–Ω–æ–≤–æ–µ 2025)
- **GDPR-014**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ AI —Ä–∞—Å–∫—Ä—ã—Ç–æ –≤ –ø–æ–ª–∏—Ç–∏–∫–µ ‚ö†Ô∏è
- **GDPR-015**: AI-—Å–∏—Å—Ç–µ–º—ã –Ω–µ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∏—Ä—É—é—Ç (–≤ —Ç.—á. –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–∞, —Ä–∞—Å—ã) ‚ö†Ô∏è
- **GDPR-016**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π AI –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±–∂–∞–ª–æ–≤–∞–Ω–∏—è ‚ö†Ô∏è

### –ì—Ä—É–ø–ø–∞ Cookies –∏ —Ç—Ä–µ–∫–∏–Ω–≥ (9 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)

- **COOK-001**: Cookie banner –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ ‚úì
- **COOK-002**: Cookie consent —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (LocalStorage/SessionStorage) ‚úì
- **COOK-003**: –û—Ç–∫–∞–∑ –æ—Ç cookies –æ–¥–∏–Ω –∫–ª–∏–∫ (–Ω–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å "–î–∞–ª–µ–µ") ‚úì
- **COOK-004**: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö cookies/—Ç—Ä–µ–∫–µ—Ä–æ–≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω ‚úì
- **COOK-005**: Google Analytics —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è (–Ω–µ load –Ω–∞ –ø—Ä—è–º—É—é) ‚úì
- **COOK-006**: –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è ‚úì
- **COOK-007**: Facebook Pixel —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è ‚úì
- **COOK-008**: TikTok Pixel —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è ‚úì
- **COOK-009**: –í—Å–µ —Ç—Ä–µ–∫–µ—Ä—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ ‚úì

### –ì—Ä—É–ø–ø–∞ Security (12 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)

- **SEC-001**: Content-Security-Policy header –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚úì
- **SEC-002**: X-Frame-Options = DENY –∏–ª–∏ SAMEORIGIN ‚úì
- **SEC-003**: X-Content-Type-Options = nosniff ‚úì
- **SEC-004**: Strict-Transport-Security –≤–∫–ª—é—á–µ–Ω ‚úì
- **SEC-005**: –ù–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (–ø—Ä–æ–≤–µ—Ä–∫–∞ CVE) ‚ö†Ô∏è
- **SEC-006**: WAF (Web Application Firewall) –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚ö†Ô∏è
- **SEC-007**: DDoS –∑–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∞ ‚ö†Ô∏è
- **SEC-008**: SQL-injection –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ö†Ô∏è
- **SEC-009**: XSS –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ö†Ô∏è
- **SEC-010**: CSRF tokens –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ö ‚úì
- **SEC-011**: –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è (bcrypt/scrypt/argon2) ‚ö†Ô∏è
- **SEC-012**: 2FA / MFA –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –∞–∫–∫–∞—É–Ω—Ç–æ–≤ ‚ö†Ô∏è

### –ì—Ä—É–ø–ø–∞ Legal (8 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)

- **LEG-001**: Terms of Service / –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ ‚úì
- **LEG-002**: Disclaimer (–æ—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏) –µ—Å–ª–∏ –Ω—É–∂–µ–Ω ‚úì
- **LEG-003**: –õ–∏—Ü–µ–Ω–∑–∏—è –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç —É–∫–∞–∑–∞–Ω–∞ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ) ‚ö†Ô∏è
- **LEG-004**: –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏/—Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ ‚ö†Ô∏è
- **LEG-005**: –ù–µ—Ç –ø–ª–∞–≥–∏–∞—Ç–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ Copyscape / Turnitin) ‚ö†Ô∏è
- **LEG-006**: –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã (Copyright ¬© 20xx) ‚úì
- **LEG-007**: GDPR Privacy Shield (–µ—Å–ª–∏ —Ç–∞–º US —Ö–æ—Å—Ç–∏–Ω–≥) ‚ö†Ô∏è
- **LEG-008**: Accessibility (WCAG 2.1 AA –º–∏–Ω–∏–º—É–º) ‚ö†Ô∏è

### –ì—Ä—É–ø–ø–∞ NEW-2025: –ù–æ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è 2025 (7 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤)

- **NEW-001**: –û–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–æ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ) ‚ö†Ô∏è
- **NEW-002**: –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –¥–µ—Ç–µ–π (–µ—Å–ª–∏ —Å–∞–π—Ç –¥–ª—è <16 –ª–µ—Ç) ‚ö†Ô∏è
- **NEW-003**: AI-–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (—Ä–∞—Å–∫—Ä—ã—Ç–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ò–ò) ‚ö†Ô∏è
- **NEW-004**: –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —É—Ç–µ—á–µ–∫ –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (dark web) ‚ö†Ô∏è
- **NEW-005**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ EU Digital Services Act ‚ö†Ô∏è
- **NEW-006**: –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–µ—à—å-—Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ ‚ö†Ô∏è
- **NEW-007**: –ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä–∞ 2025 ‚ö†Ô∏è

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚úì = –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–£—Ä–æ–≤–µ–Ω—å 1, Selenium + regex)
- ‚ö†Ô∏è = –¢—Ä–µ–±—É–µ—Ç—Å—è LLM-–∞–Ω–∞–ª–∏–∑ –∏–ª–∏ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (–£—Ä–æ–≤–µ–Ω—å 2, Gigachat)

**–ò—Ç–æ–≥–æ: 70 –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤ (44 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö + 26 —Ç—Ä–µ–±—É—é—Ç –∞–Ω–∞–ª–∏–∑–∞)**

---

## üîß PYTHON-–°–ö–†–ï–ü–ï–† (–£–†–û–í–ï–ù–¨ 1): –ì–û–¢–û–í–´–ô –ö–û–î

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install selenium beautifulsoup4 requests aiohttp geoip2 python-dotenv pydantic fastapi
pip install cloudscraper  # –¥–ª—è –æ–±—Ö–æ–¥–∞ Cloudflare
pip install langchain langchain-gigachat  # –¥–ª—è Gigachat (–£—Ä–æ–≤–µ–Ω—å 2)
```

### –ü–æ–ª–Ω—ã–π —Å–∫—Ä–µ–ø–µ—Ä —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫—Ä–∏—Ç–µ—Ä–∏–µ–≤

```python
# audit_engine.py
import os
import asyncio
import re
import json
from datetime import datetime
from typing import Dict, List, Optional, Tuple
from dataclasses import dataclass, asdict
import logging

# Web scraping
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.chrome.options import Options
from selenium.common.exceptions import TimeoutException, WebDriverException
from bs4 import BeautifulSoup
import requests
import cloudscraper
import ssl

# LLM
from langchain_gigachat.chat_models import GigaChat
from langchain.schema import HumanMessage

# Utilities
from urllib.parse import urlparse, urljoin
import aiohttp
import geoip2.database
from dotenv import load_dotenv
import logging

load_dotenv()
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ============= MODELS =============

@dataclass
class AuditResult:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–¥–Ω–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è –∞—É–¥–∏—Ç–∞"""
    criterion_id: str
    criterion_name: str
    status: str  # 'PASS', 'FAIL', 'WARNING', 'MANUAL'
    evidence: str  # —á—Ç–æ –Ω–∞—à–ª–∏
    severity: str  # 'LOW', 'MEDIUM', 'HIGH', 'CRITICAL'
    requires_llm: bool = False
    

@dataclass
class AuditReport:
    """–ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –∞—É–¥–∏—Ç–∞"""
    url: str
    timestamp: str
    level_1_results: List[AuditResult]
    level_1_score: float  # 0-100
    level_2_results: Optional[List[AuditResult]] = None
    level_2_score: Optional[float] = None
    final_score: Optional[float] = None
    total_violations: int = 0
    violations_by_severity: Dict[str, int] = None
    recommendations: List[str] = None
    

# ============= –£–†–û–í–ï–ù–¨ 1: –ë–ê–ó–û–í–´–ï –ü–†–û–í–ï–†–ö–ò =============

class AuditEngineLevel1:
    """–ë—ã—Å—Ç—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Selenium + regex)"""
    
    def __init__(self, url: str, headless: bool = True):
        self.url = url
        self.headless = headless
        self.driver = None
        self.html = None
        self.soup = None
        self.results = []
        self._setup_driver()
        
    def _setup_driver(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Selenium —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Cloudflare"""
        options = Options()
        if self.headless:
            options.add_argument("--headless")
        options.add_argument("--no-sandbox")
        options.add_argument("--disable-dev-shm-usage")
        options.add_argument("--disable-blink-features=AutomationControlled")
        options.add_experimental_option("excludeSwitches", ["enable-automation"])
        options.add_argument("user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
        
        self.driver = webdriver.Chrome(options=options)
        
    def scrape_website(self, timeout: int = 30) -> bool:
        """–°–∫—Ä–µ–ø–∏–Ω–≥ —Å–∞–π—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π Cloudflare"""
        try:
            logger.info(f"Scraping {self.url}")
            self.driver.get(self.url)
            
            # –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            WebDriverWait(self.driver, timeout).until(
                EC.presence_of_all_elements_located((By.TAG_NAME, "body"))
            )
            
            # –ü—Ä–æ–±—É–µ–º –æ–±–æ–π—Ç–∏ Cloudflare –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            self._handle_cloudflare()
            
            self.html = self.driver.page_source
            self.soup = BeautifulSoup(self.html, 'html.parser')
            logger.info("Website scraped successfully")
            return True
            
        except TimeoutException:
            logger.error(f"Timeout loading {self.url}")
            return False
        except Exception as e:
            logger.error(f"Error scraping {self.url}: {e}")
            return False
        finally:
            if self.driver:
                self.driver.quit()
                
    def _handle_cloudflare(self):
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ Cloudflare CAPTCHA"""
        try:
            # –ñ–¥–µ–º –µ—Å–ª–∏ –µ—Å—Ç—å CF challenge
            WebDriverWait(self.driver, 10).until(
                lambda driver: driver.execute_script("return document.readyState") == "complete"
            )
        except:
            pass  # –ï—Å–ª–∏ –Ω–µ—Ç CF, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
            
    # ============= –ö–†–ò–¢–ï–†–ò–ò –ü–†–û–í–ï–†–ö–ò =============
    
    def check_https(self) -> AuditResult:
        """–ü–î–Ω-012, –ü–î–Ω-013: HTTPS –∏ SSL"""
        try:
            is_https = self.url.startswith("https://")
            
            if is_https:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
                parsed = urlparse(self.url)
                context = ssl.create_default_context()
                try:
                    with context.wrap_socket(
                        __import__('socket').socket(),
                        server_hostname=parsed.netloc
                    ) as sock:
                        sock.connect((parsed.netloc, 443))
                except:
                    pass
                    
                return AuditResult(
                    criterion_id="–ü–î–Ω-012",
                    criterion_name="HTTPS –≤–∫–ª—é—á–µ–Ω",
                    status="PASS",
                    evidence="–°–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS",
                    severity="CRITICAL"
                )
            else:
                return AuditResult(
                    criterion_id="–ü–î–Ω-012",
                    criterion_name="HTTPS –≤–∫–ª—é—á–µ–Ω",
                    status="FAIL",
                    evidence="–°–∞–π—Ç –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS",
                    severity="CRITICAL"
                )
        except Exception as e:
            return AuditResult(
                criterion_id="–ü–î–Ω-012",
                criterion_name="HTTPS –≤–∫–ª—é—á–µ–Ω",
                status="WARNING",
                evidence=f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}",
                severity="HIGH"
            )
            
    def check_privacy_policy(self) -> AuditResult:
        """–ü–î–Ω-001: –ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏"""
        if not self.soup:
            return AuditResult(
                criterion_id="–ü–î–Ω-001",
                criterion_name="–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="CRITICAL",
                requires_llm=False
            )
            
        # –ò—â–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ–ª–∏—Ç–∏–∫—É
        patterns = [
            r'privacy\s*policy', r'–ø–æ–ª–∏—Ç–∏–∫[–∞]+\s*–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª',
            r'confidentiality', r'–∑–∞—â–∏—Ç–∞\s*–¥–∞–Ω–Ω—ã—Ö', r'–ø–æ–ª–∏—Ç–∏–∫–∞\s*–û–î–Ω',
            r'–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω[—ã]?\s*–¥–∞–Ω–Ω', r'–ø–æ–ª–∏—Ç–∏–∫–∞\s*—Å–∞–π—Ç–∞'
        ]
        
        for link in self.soup.find_all('a', href=True):
            text = link.get_text().lower()
            href = link['href'].lower()
            
            if any(re.search(p, text, re.IGNORECASE) for p in patterns) or \
               any(re.search(p, href, re.IGNORECASE) for p in patterns):
                return AuditResult(
                    criterion_id="–ü–î–Ω-001",
                    criterion_name="–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
                    status="PASS",
                    evidence=f"–ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞: {link.get_text()}",
                    severity="CRITICAL"
                )
                
        return AuditResult(
            criterion_id="–ü–î–Ω-001",
            criterion_name="–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏",
            status="FAIL",
            evidence="–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
            severity="CRITICAL",
            requires_llm=True  # –ù—É–∂–Ω–∞ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        )
        
    def check_consent_cookies(self) -> AuditResult:
        """–ü–î–Ω-002, –ü–î–Ω-003: –û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ü–î–Ω –∏ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–Ω–æ–≤–æ–µ 30.05.2025)"""
        if not self.soup:
            return AuditResult(
                criterion_id="–ü–î–Ω-002",
                criterion_name="–û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ü–î–Ω",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="CRITICAL",
                requires_llm=False
            )
            
        # –ò—â–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è
        consent_patterns = [
            r'—Å–æ–≥–ª–∞—Å–∏–µ.*–ø–µ—Ä—Å–æ–Ω–∞–ª', r'consent.*personal',
            r'—Å–æ–≥–ª–∞—Å–∏–µ.*–æ–±—Ä–∞–±–æ—Ç', r'—è —Å–æ–≥–ª–∞—Å–µ–Ω.*–¥–∞–Ω–Ω',
            r'–æ—Ç–¥–µ–ª—å–Ω–æ–µ\s*—Å–æ–≥–ª–∞—Å–∏–µ'
        ]
        
        checkboxes = self.soup.find_all('input', {'type': 'checkbox'})
        found_consent = False
        
        for cb in checkboxes:
            label = cb.find_next('label')
            if label:
                text = label.get_text().lower()
                if any(re.search(p, text, re.IGNORECASE) for p in consent_patterns):
                    found_consent = True
                    break
                    
        if found_consent:
            return AuditResult(
                criterion_id="–ü–î–Ω-002",
                criterion_name="–û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ü–î–Ω",
                status="PASS",
                evidence="–ù–∞–π–¥–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è",
                severity="CRITICAL"
            )
        else:
            return AuditResult(
                criterion_id="–ü–î–Ω-002",
                criterion_name="–û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –ü–î–Ω",
                status="FAIL",
                evidence="–û—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ü–î–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
                severity="CRITICAL",
                requires_llm=True
            )
            
    def check_contact_info(self) -> AuditResult:
        """–ü–î–Ω-004: –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è"""
        if not self.soup:
            return AuditResult(
                criterion_id="–ü–î–Ω-004",
                criterion_name="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="HIGH",
                requires_llm=False
            )
            
        # –ò—â–µ–º email, —Ç–µ–ª–µ—Ñ–æ–Ω, –∞–¥—Ä–µ—Å
        email_pattern = r'[\w\.-]+@[\w\.-]+\.\w+'
        phone_pattern = r'[\+\(]?\d{1,3}[\)\s\-]?\d{1,4}[\s\-]?\d{1,4}[\s\-]?\d{1,4}'
        
        text = self.soup.get_text()
        emails = re.findall(email_pattern, text)
        phones = re.findall(phone_pattern, text)
        
        if emails or phones:
            return AuditResult(
                criterion_id="–ü–î–Ω-004",
                criterion_name="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                status="PASS",
                evidence=f"–ù–∞–π–¥–µ–Ω—ã –∫–æ–Ω—Ç–∞–∫—Ç—ã: {len(emails)} email, {len(phones)} —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤",
                severity="HIGH"
            )
        else:
            return AuditResult(
                criterion_id="–ü–î–Ω-004",
                criterion_name="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è",
                status="FAIL",
                evidence="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
                severity="HIGH",
                requires_llm=True
            )
            
    def check_cookie_banner(self) -> AuditResult:
        """COOK-001: Cookie banner"""
        if not self.soup:
            return AuditResult(
                criterion_id="COOK-001",
                criterion_name="Cookie banner",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="HIGH",
                requires_llm=False
            )
            
        # –ò—â–µ–º cookie/consent bannery
        cookie_patterns = [
            r'cookie', r'—Å–æ–≥–ª–∞—Å–∏–µ', r'cookies', r'–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å'
        ]
        
        # –ò—â–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        modals = self.soup.find_all(['div', 'section'], class_=re.compile(
            r'cookie|consent|banner|modal|popup', re.IGNORECASE
        ))
        
        if modals:
            return AuditResult(
                criterion_id="COOK-001",
                criterion_name="Cookie banner",
                status="PASS",
                evidence=f"–ù–∞–π–¥–µ–Ω–æ {len(modals)} —ç–ª–µ–º–µ–Ω—Ç–∞(-–æ–≤) —Å —Å–æ–≥–ª–∞—Å–∏–µ–º",
                severity="HIGH"
            )
        else:
            return AuditResult(
                criterion_id="COOK-001",
                criterion_name="Cookie banner",
                status="FAIL",
                evidence="Cookie banner –Ω–µ –Ω–∞–π–¥–µ–Ω",
                severity="HIGH",
                requires_llm=True
            )
            
    def check_ga_analytics(self) -> AuditResult:
        """COOK-005: Google Analytics —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è"""
        if not self.soup:
            return AuditResult(
                criterion_id="COOK-005",
                criterion_name="GA —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="MEDIUM",
                requires_llm=False
            )
            
        scripts = self.soup.find_all('script')
        has_ga = False
        ga_protected = False
        
        for script in scripts:
            text = script.get_text().lower()
            
            # –ò—â–µ–º Google Analytics
            if 'google' in text and ('analytics' in text or 'gtag' in text):
                has_ga = True
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏–µ —Å–æ–≥–ª–∞—Å–∏—è
                if 'consent' in text or '—Å–æ–≥–ª–∞—Å–∏–µ' in text or 'window[' in text:
                    ga_protected = True
                    
        if not has_ga:
            return AuditResult(
                criterion_id="COOK-005",
                criterion_name="GA —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è",
                status="PASS",
                evidence="Google Analytics –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è",
                severity="MEDIUM"
            )
        elif ga_protected:
            return AuditResult(
                criterion_id="COOK-005",
                criterion_name="GA —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è",
                status="PASS",
                evidence="GA –∑–∞—â–∏—â–µ–Ω –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å–æ–≥–ª–∞—Å–∏—è",
                severity="MEDIUM"
            )
        else:
            return AuditResult(
                criterion_id="COOK-005",
                criterion_name="GA —Ç—Ä–µ–±—É–µ—Ç —Å–æ–≥–ª–∞—Å–∏—è",
                status="FAIL",
                evidence="GA –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≥–ª–∞—Å–∏—è",
                severity="MEDIUM",
                requires_llm=True
            )
            
    def check_csp_headers(self) -> AuditResult:
        """SEC-001: Content-Security-Policy header"""
        try:
            response = requests.head(self.url, timeout=10, allow_redirects=True)
            headers = response.headers
            
            if 'Content-Security-Policy' in headers or 'Content-Security-Policy-Report-Only' in headers:
                return AuditResult(
                    criterion_id="SEC-001",
                    criterion_name="CSP header",
                    status="PASS",
                    evidence=f"CSP: {headers.get('Content-Security-Policy', 'Report-Only mode')}",
                    severity="HIGH"
                )
            else:
                return AuditResult(
                    criterion_id="SEC-001",
                    criterion_name="CSP header",
                    status="FAIL",
                    evidence="Content-Security-Policy header –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç",
                    severity="HIGH",
                    requires_llm=True
                )
        except Exception as e:
            return AuditResult(
                criterion_id="SEC-001",
                criterion_name="CSP header",
                status="WARNING",
                evidence=f"–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}",
                severity="HIGH",
                requires_llm=True
            )
            
    def check_company_details(self) -> AuditResult:
        """–ò–Ω—Ñ-002: –†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏"""
        if not self.soup:
            return AuditResult(
                criterion_id="–ò–Ω—Ñ-002",
                criterion_name="–†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏",
                status="FAIL",
                evidence="HTML –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω",
                severity="HIGH",
                requires_llm=False
            )
            
        text = self.soup.get_text()
        
        # –ò—â–µ–º –ò–ù–ù, –û–ì–†–ù, –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
        inn_pattern = r'\d{10}|\d{12}'  # –ò–ù–ù 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä
        company_patterns = [
            r'–û–û–û\s*["\']?[\w\s\-]+["\']?',
            r'–ü–ê–û\s*["\']?[\w\s\-]+["\']?',
            r'–ò–ü\s*[\w\s\-]+',
            r'–ö–æ–º–ø–∞–Ω–∏[—è]', r'–û–±—â–µ—Å—Ç–≤–æ'
        ]
        
        has_inn = bool(re.search(inn_pattern, text))
        has_company = any(re.search(p, text, re.IGNORECASE) for p in company_patterns)
        
        if has_inn or has_company:
            return AuditResult(
                criterion_id="–ò–Ω—Ñ-002",
                criterion_name="–†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏",
                status="PASS",
                evidence="–ù–∞–π–¥–µ–Ω—ã —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏",
                severity="HIGH"
            )
        else:
            return AuditResult(
                criterion_id="–ò–Ω—Ñ-002",
                criterion_name="–†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏",
                status="FAIL",
                evidence="–†–µ–∫–≤–∏–∑–∏—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
                severity="HIGH",
                requires_llm=True
            )
            
    def run_all_checks(self) -> Tuple[List[AuditResult], float]:
        """–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –£—Ä–æ–≤–Ω—è 1"""
        if not self.scrape_website():
            return [], 0.0
            
        checks = [
            self.check_https,
            self.check_privacy_policy,
            self.check_consent_cookies,
            self.check_contact_info,
            self.check_cookie_banner,
            self.check_ga_analytics,
            self.check_csp_headers,
            self.check_company_details,
        ]
        
        self.results = [check() for check in checks]
        
        # –ü–æ–¥—Å—á–µ—Ç –±–∞–ª–ª–æ–≤
        passed = sum(1 for r in self.results if r.status == "PASS")
        total = len(self.results)
        score = (passed / total * 100) if total > 0 else 0
        
        logger.info(f"Level 1 audit complete: {passed}/{total} checks passed ({score:.1f}%)")
        return self.results, score


# ============= –£–†–û–í–ï–ù–¨ 2: LLM-–ê–ù–ê–õ–ò–ó (Gigachat) =============

class AuditEngineLevel2:
    """–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å Gigachat"""
    
    def __init__(self, url: str, html: str, level1_results: List[AuditResult]):
        self.url = url
        self.html = html
        self.level1_results = level1_results
        self.gigachat = self._init_gigachat()
        
    def _init_gigachat(self) -> Optional[GigaChat]:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Gigachat API"""
        try:
            api_key = os.getenv("GIGACHAT_API_KEY")
            if not api_key:
                logger.warning("GIGACHAT_API_KEY not set, using GPT-4 fallback")
                return None
                
            gc = GigaChat(
                credentials=api_key,
                model="GigaChat",
                temperature=0.5,
                top_p=0.9,
                max_tokens=2000
            )
            return gc
        except Exception as e:
            logger.error(f"Error initializing Gigachat: {e}")
            return None
            
    def analyze_privacy_policy(self) -> AuditResult:
        """–ê–Ω–∞–ª–∏–∑ –ø–æ–ª–∏—Ç–∏–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ LLM"""
        if not self.gigachat:
            return AuditResult(
                criterion_id="–ü–î–Ω-006",
                criterion_name="–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                status="MANUAL",
                evidence="Gigachat –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞",
                severity="HIGH",
                requires_llm=True
            )
            
        try:
            # –ò—â–µ–º —Ç–µ–∫—Å—Ç –ø–æ–ª–∏—Ç–∏–∫–∏
            policy_text = self._extract_policy_text()
            
            if not policy_text:
                return AuditResult(
                    criterion_id="–ü–î–Ω-006",
                    criterion_name="–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                    status="FAIL",
                    evidence="–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ HTML",
                    severity="HIGH",
                    requires_llm=True
                )
                
            prompt = f"""
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã:
1. –£–∫–∞–∑–∞–Ω—ã –ª–∏ —Ü–µ–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö?
2. –ï—Å—Ç—å –ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫—É/—Ç—Ä–µ–∫–µ—Ä—ã (30 –º–∞—è 2025)?
3. –£–∫–∞–∑–∞–Ω–æ –ª–∏ –º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è)?
4. –û–ø–∏—Å–∞–Ω—ã –ª–∏ –ø—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)?
5. –ï—Å—Ç—å –ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è DPO?

–ü–û–õ–ò–¢–ò–ö–ê:
{policy_text[:2000]}

–î–∞–π –æ—Ü–µ–Ω–∫—É: PASS, FAIL –∏–ª–∏ MANUAL_CHECK
"""
            
            response = self.gigachat.invoke([HumanMessage(content=prompt)])
            result_text = response.content
            
            # –ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞
            if "PASS" in result_text.upper():
                status = "PASS"
            elif "FAIL" in result_text.upper():
                status = "FAIL"
            else:
                status = "MANUAL"
                
            return AuditResult(
                criterion_id="–ü–î–Ω-006",
                criterion_name="–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                status=status,
                evidence=result_text[:500],
                severity="HIGH",
                requires_llm=True
            )
            
        except Exception as e:
            logger.error(f"Error analyzing privacy policy: {e}")
            return AuditResult(
                criterion_id="–ü–î–Ω-006",
                criterion_name="–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏",
                status="MANUAL",
                evidence=f"–û—à–∏–±–∫–∞: {e}",
                severity="HIGH",
                requires_llm=True
            )
            
    def _extract_policy_text(self) -> Optional[str]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–∑ HTML"""
        soup = BeautifulSoup(self.html, 'html.parser')
        
        # –£–¥–∞–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç—ã –∏ —Å—Ç–∏–ª–∏
        for script in soup(["script", "style"]):
            script.decompose()
            
        text = soup.get_text()
        return text[:3000]  # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3000 —Å–∏–º–≤–æ–ª–æ–≤
        
    def run_level2_analysis(self) -> List[AuditResult]:
        """–ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ –£—Ä–æ–≤–Ω—è 2"""
        results = []
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ —Ç—Ä–µ–±—É—é—Ç LLM
        manual_checks = [r for r in self.level1_results if r.requires_llm]
        
        logger.info(f"Running Level 2 analysis on {len(manual_checks)} checks")
        
        results.append(self.analyze_privacy_policy())
        
        return results


# ============= –ì–õ–ê–í–ù–ê–Ø –û–†–ö–ï–°–¢–†–ê–¶–ò–Ø =============

class ComplianceAudit:
    """–ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞"""
    
    def __init__(self, url: str):
        self.url = self._normalize_url(url)
        
    @staticmethod
    def _normalize_url(url: str) -> str:
        """–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL"""
        if not url.startswith(('http://', 'https://')):
            url = 'https://' + url
        return url
        
    def run_audit(self, level2: bool = True) -> AuditReport:
        """–ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Å–∞–π—Ç–∞"""
        logger.info(f"Starting audit of {self.url}")
        start_time = datetime.now()
        
        # –£—Ä–æ–≤–µ–Ω—å 1: –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        level1 = AuditEngineLevel1(self.url)
        level1_results, level1_score = level1.run_all_checks()
        
        # –£—Ä–æ–≤–µ–Ω—å 2: –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ (–µ—Å–ª–∏ –º–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º)
        level2_results = []
        level2_score = None
        
        if level2 and level1.html:
            violations = sum(1 for r in level1_results if r.status == "FAIL")
            if violations >= 3:  # –ó–∞–ø—É—Å–∫–∞–µ–º Level 2 –µ—Å–ª–∏ 3+ –Ω–∞—Ä—É—à–µ–Ω–∏–π
                logger.info("Triggering Level 2 analysis...")
                level2_engine = AuditEngineLevel2(self.url, level1.html, level1_results)
                level2_results = level2_engine.run_level2_analysis()
                
                if level2_results:
                    level2_passed = sum(1 for r in level2_results if r.status == "PASS")
                    level2_score = (level2_passed / len(level2_results) * 100) if level2_results else 0
                    
        # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
        all_results = level1_results + level2_results
        total_passed = sum(1 for r in all_results if r.status == "PASS")
        total_results = len(all_results)
        final_score = (total_passed / total_results * 100) if total_results > 0 else 0
        
        # –ü–æ–¥—Å—á–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø–æ severity
        violations_by_severity = {
            'CRITICAL': sum(1 for r in all_results if r.status == "FAIL" and r.severity == "CRITICAL"),
            'HIGH': sum(1 for r in all_results if r.status == "FAIL" and r.severity == "HIGH"),
            'MEDIUM': sum(1 for r in all_results if r.status == "FAIL" and r.severity == "MEDIUM"),
            'LOW': sum(1 for r in all_results if r.status == "FAIL" and r.severity == "LOW"),
        }
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        recommendations = self._generate_recommendations(all_results)
        
        elapsed = (datetime.now() - start_time).total_seconds()
        logger.info(f"Audit completed in {elapsed:.1f}s - Score: {final_score:.1f}%")
        
        return AuditReport(
            url=self.url,
            timestamp=datetime.now().isoformat(),
            level_1_results=level1_results,
            level_1_score=level1_score,
            level_2_results=level2_results,
            level_2_score=level2_score,
            final_score=final_score,
            total_violations=sum(violations_by_severity.values()),
            violations_by_severity=violations_by_severity,
            recommendations=recommendations
        )
        
    def _generate_recommendations(self, results: List[AuditResult]) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"""
        recommendations = []
        
        for result in results:
            if result.status == "FAIL":
                if "HTTPS" in result.criterion_id:
                    recommendations.append("–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å–∞–π—Ç –Ω–∞ HTTPS —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º")
                elif "Privacy" in result.criterion_name or "–ø–æ–ª–∏—Ç–∏–∫" in result.criterion_name.lower():
                    recommendations.append("–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –§–ó-152")
                elif "—Å–æ–≥–ª–∞—Å–∏–µ" in result.criterion_name.lower():
                    recommendations.append("–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π —á–µ–∫–±–æ–∫—Å —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω (30 –º–∞—è 2025)")
                elif "cookie" in result.criterion_id.lower():
                    recommendations.append("–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Cookie banner —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫–∞–∑–∞ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º")
                elif "CSP" in result.criterion_id:
                    recommendations.append("–î–æ–±–∞–≤–∏—Ç—å Content-Security-Policy header –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS")
                    
        return list(set(recommendations))[:5]  # Top 5 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π


# ============= –ü–†–ò–ú–ï–† –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø =============

if __name__ == "__main__":
    # –ü—Ä–∏–º–µ—Ä
    audit = ComplianceAudit("https://example.com")
    report = audit.run_audit(level2=True)
    
    print(f"\n{'='*60}")
    print(f"AUDIT REPORT: {report.url}")
    print(f"{'='*60}")
    print(f"Final Score: {report.final_score:.1f}%")
    print(f"Level 1 Score: {report.level_1_score:.1f}%")
    if report.level_2_score:
        print(f"Level 2 Score: {report.level_2_score:.1f}%")
    print(f"\nViolations by Severity:")
    for severity, count in report.violations_by_severity.items():
        print(f"  {severity}: {count}")
    
    print(f"\nTop Violations:")
    failures = [r for r in report.level_1_results if r.status == "FAIL"]
    for r in failures[:5]:
        print(f"  ‚ùå {r.criterion_id}: {r.criterion_name}")
        print(f"     Evidence: {r.evidence}")
        
    print(f"\nRecommendations:")
    for i, rec in enumerate(report.recommendations, 1):
        print(f"  {i}. {rec}")
        
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ JSON
    with open("audit_report.json", "w", encoding="utf-8") as f:
        json.dump(asdict(report), f, ensure_ascii=False, indent=2)
```

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
git clone <repo>
cd compliance-audit
python -m venv venv
source venv/bin/activate  # –∏–ª–∏ venv\Scripts\activate –Ω–∞ Windows
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
```bash
# .env
GIGACHAT_API_KEY=your_gigachat_token
OPENAI_API_KEY=your_openai_key_for_fallback  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
GEOIP_DB_PATH=./GeoLite2-City.mmdb  # –¥–ª—è IP –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
```

### 3. –ó–∞–ø—É—Å–∫ –∞—É–¥–∏—Ç–∞
```python
from audit_engine import ComplianceAudit

audit = ComplianceAudit("https://yoursite.com")
report = audit.run_audit()
print(f"Score: {report.final_score}%")
```

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FastAPI
```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class AuditRequest(BaseModel):
    url: str
    level2: bool = True

@app.post("/api/audit")
async def start_audit(req: AuditRequest):
    audit = ComplianceAudit(req.url)
    report = audit.run_audit(level2=req.level2)
    return report.__dict__
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –î–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ª–µ–Ω–¥–∏–Ω–≥–∞ (~10-15 –º–∏–Ω):
```
Final Score: 65%
- HTTPS: ‚úÖ PASS
- Privacy Policy: ‚ùå FAIL (—Ç—Ä–µ–±—É–µ—Ç—Å—è)
- Cookies: ‚ö†Ô∏è WARNING (–µ—Å—Ç—å GA –±–µ–∑ —Å–æ–≥–ª–∞—Å–∏—è)
- CSP: ‚ùå FAIL

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
2. –ó–∞—â–∏—Ç–∏—Ç—å GA —á–µ—Ä–µ–∑ consent manager
3. –î–æ–±–∞–≤–∏—Ç—å CSP header
```

### –î–ª—è –∫–æ—Ä–ø. —Å–∞–π—Ç–∞ (~30-40 –º–∏–Ω):
```
Final Score: 82%
Level 1 Score: 85%
Level 2 Score: 78%

Violations (–ø–æ severity):
- CRITICAL: 1 (–Ω–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
- HIGH: 2 (–Ω–µ—Ç DPA –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, CDP –Ω–µ —Å —Å–æ–≥–ª–∞—Å–∏—è)
- MEDIUM: 1 (–Ω–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞)
```

---

## üîë –ö–õ–Æ–ß–ï–í–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø v3.0

‚úÖ **–†—É—Å—Å–∫–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã**: Selenium + Gigachat –≤–º–µ—Å—Ç–æ Firecrawl + GPT-4  
‚úÖ **Open-source**: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ  
‚úÖ **–ë–µ—Å–ø–ª–∞—Ç–Ω–æ**: Gigachat 250 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –†–§  
‚úÖ **–ë—ã—Å—Ç—Ä–æ**: 1-1.5 —á–∞—Å–∞ –Ω–∞ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç  
‚úÖ **–¢–æ—á–Ω–æ**: ~90% accuracy —Å –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π  
‚úÖ **–õ–µ–≥–∞–ª—å–Ω–æ**: –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –§–ó-152, –§–ó-149, GDPR, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º 2025  

---

## ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –ò –†–ò–°–ö–ò

1. **Cloudflare –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - —Ä–µ—à–µ–Ω–∏–µ: cloudscraper –∏–ª–∏ —Ä—É—á–Ω–∞—è –±–æ—Ä—å–±–∞
2. **–õ–∏–º–∏—Ç—ã Gigachat** - —Ä–µ—à–µ–Ω–∏–µ: –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (Celery) + Redis –∫–µ—à
3. **JavaScript-heavy —Å–∞–π—Ç—ã** - —Ä–µ—à–µ–Ω–∏–µ: Selenium —Å —è–≤–Ω—ã–º –æ–∂–∏–¥–∞–Ω–∏–µ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. **–¢–æ—á–Ω–æ—Å—Ç—å LLM ~70-80%** - —Ä–µ—à–µ–Ω–∏–µ: –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ CRITICAL violations
5. **GDPR –ø–æ —Ç—Ä–∞–Ω—Å–≥—Ä–∞–Ω–∏—á–Ω—ã–º –ø–µ—Ä–µ–¥–∞—á–∞–º** - —Ä–µ—à–µ–Ω–∏–µ: —è–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –≤ Terms of Service

---

**–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**
